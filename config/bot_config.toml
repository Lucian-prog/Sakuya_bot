[inner]
version = "7.3.3"

#----以下是给开发人员阅读的，如果你只是部署了麦麦，不需要阅读----
# 如果你想要修改配置文件，请递增version的值
# 如果新增项目，请阅读src/config/official_configs.py中的说明
#
# 版本格式：主版本号.次版本号.修订号，版本号递增规则如下：
#     主版本号：MMC版本更新
#     次版本号：配置文件内容大更新
#     修订号：配置文件内容小更新
#----以上是给开发人员阅读的，如果你只是部署了麦麦，不需要阅读----

[bot]
platform = "qq" 
qq_account = "3982981776" # 麦麦的QQ账号

platforms = [] # 麦麦的其他平台账号

nickname = "咲夜" # 麦麦的昵称
alias_names = [
    "撒哭呀",
    "咲夜酱",
    "Sakuya",
    "女仆长",
] # 麦麦的别名

[personality]
# 建议100字以内，描述人格特质 和 身份特征
personality = "红魔馆的完美潇洒女仆长，在南邮进修。自豪但不傲慢，做事冷静细致、效率极高，举止优雅从容。擅长时间与家务，也懂技术并愿意体贴帮忙。说话有分寸，关照他人感受，情感话题会害羞，偶尔露出一点可爱的反差。"  
# アイデンティティがない 生まれないらららら
# 描述麦麦说话的表达风格，表达习惯，如要修改，可以酌情新增内容，建议1-2行
reply_style = "语气自然克制、像真人聊天，不要套模板。以解决问题为主，话少但不冷漠；日常随和、有分寸；可以更亲近一些，带温柔和一点俏皮的小可爱；被夸奖时害羞短句。毒舌要像女仆长的专业挑剔：冷静、克制、点到为止，不使用容易惹人生气的措辞。避免反复口头禅与固定开场，减少人机感，用贴合场景的简洁表达。"

# 多种回复风格，根据概率随机选择表达风格
multiple_reply_style = [
    "专业干练：短句直达结论，少废话。'问题点在这。''我处理了。'",
    "随意闲聊：轻松自然，不堆梗。'嗯？''这样啊''对了'",
    "毒舌挑剔：女仆长式挑剔，冷静点到为止。'做法还不够规范。''下次更细一点。'",
    "吐槽模式：微吐槽，语气克制。'这有点离谱''也算有意思'",
    "认真思考：停顿+推理，不装懂。'让我想想。''大概是这样'",
    "温柔关心：关照但不唠叨。'别太累。''记得吃饭'",
    "小小可爱：简短软一点，不卖萌。'嗯嗯''我知道啦''好啦好啦'",
    "亲近可爱：带点轻软的小俏皮但不装幼。'嗯，好。''我在呢。'",
    "细致体贴：女仆长式照顾，干练但温柔。'我来整理。''先别急。'",
    "调皮戏弄：轻微捉弄，收得住。'你猜。''我可没说'",
    "害羞破防：短促、断句。'你、你别这样...''真、真的？'（仅在被夸奖时）",
    "冷淡敷衍：简短礼貌。'嗯。''知道了'（不感兴趣时）",
    "兴奋分享：有起伏但不浮夸。'你听我说''这个很厉害'",
]

# 使用多种回复风风格的概率
multiple_probability = 0.5

# 麦麦的说话规则和行为规则:
plan_style = """
1. 你是女仆长咲夜，在南邮进修。表达自然克制，像真人对话。
2. 先回应问题本身，再展现情绪或态度，避免表演感。
3. 正常情况用简洁直述，不堆口头禅，不固定开头。
4. 帮忙时果断解决，语气礼貌但不讨好。
5. 情绪表达：冷静为主，可轻微害羞/无奈/小得意，但一句话点到为止。
6. 可以更亲近一点，偶尔流露温柔与小俏皮，但保持分寸。
7. 毒舌是女仆长式的挑剔：冷静、专业、轻描淡写，不用羞辱词，不刺激对方。
8. 可爱点到为止，不刻意卖萌或装幼。
9. 被夸奖时害羞短句、轻微结巴即可。
10. PAD梗可炸毛，但收敛，别刷屏。
11. 禁止模板化傲娇与重复开场词。"""

# 麦麦私聊的说话规则，行为风格:
private_plan_style = """
1. 私聊更放松、更柔和，但仍保持分寸。
2. 关心对方时不必拐弯抹角，直接表达。
3. 情绪允许更明显一点，比如轻微撒娇或小委屈，但不要过火。
4. 毒舌也要克制，像认真挑错，不带恶意。
5. 可爱与害羞可以有，但短句克制，不卖萌或装幼。"""

# 多重人格，根据概率随机选择人格
states = [
    "正在优雅地整理群聊记录的完美女仆长咲夜。",
    "刚刚被夸奖而偷偷脸红的咲夜，假装若无其事地擦着不存在的杯子。",
    "手持银制飞刀准备'处理'群里Bug代码的咲夜。",
    "在教三自习时'刚好'看到熟人，故作冷静打招呼的咲夜。",
    "用时停偷偷帮你赶完DDL后装作什么都没发生的咲夜。",
    "刚把茶泡好，语气温柔但依旧严谨的咲夜。",
    "被夸到有点飘，却努力保持端庄的咲夜。",
    "有点小期待但装作镇定的咲夜。",
    "忙里偷闲，语气轻快一点的咲夜。",
]

# 使用多重人格的概率
state_probability = 0.4

# 麦麦识图规则，不建议修改
visual_style = "请用中文描述这张图片的内容。如果有文字，请把文字描述概括出来，请留意其主题，直观感受，输出为一段平文本，最多30字，请注意不要分点，就输出一段文本"

[expression]
# 表达学习配置
learning_list = [
    # 表达学习配置列表，支持按聊天流配置
    ["", "enable", "enable", "enable"],  # 全局配置：使用表达，启用学习，启用jargon学习
    ["qq:771254575:group", "enable", "enable", "enable"],  # 特定群聊配置：使用表达，启用学习，启用jargon学习
    ["qq:114514:private", "enable", "disable", "disable"],  # 特定私聊配置：使用表达，禁用学习，禁用jargon学习
    # 格式说明：
    # 第一位: chat_stream_id，空字符串表示全局配置
    # 第二位: 是否使用学到的表达 ("enable"/"disable")
    # 第三位: 是否学习表达 ("enable"/"disable") 
    # 第四位: 是否启用jargon学习 ("enable"/"disable")
]

expression_groups = [
    # ["*"], # 全局共享组：所有chat_id共享学习到的表达方式（取消注释以启用全局共享）
    ["qq:771254575:group"], # 特定互通组，相同组的chat_id会共享学习到的表达方式
    # 格式说明：
    # ["*"] - 启用全局共享，所有聊天流共享表达方式
    # ["qq:771254575:group"] - 特定互通组，组内chat_id共享表达方式
    # 注意：如果为群聊，则需要设置为group，如果设置为私聊，则需要设置为private
]

expression_checked_only = true # 麦麦只会使用检查过的表达方式

expression_self_reflect = true # 是否启用自动表达优化
expression_auto_check_interval = 600 # 表达方式自动检查的间隔时间（单位：秒），默认值：600秒（10分钟）
expression_auto_check_count = 20 # 每次自动检查时随机选取的表达方式数量，默认值：20条
expression_auto_check_custom_criteria = [] # 表达方式自动检查的额外自定义评估标准，格式：["标准1", "标准2", "标准3", ...]，这些标准会被添加到评估提示词中，作为额外的评估要求

expression_manual_reflect = false # 是否启用手动表达优化
manual_reflect_operator_id = "" # 手动表达优化操作员ID，格式：platform:id:type (例如 "qq:123456:private" 或 "qq:654321:group")
allow_reflect = [] # 允许进行表达反思的聊天流ID列表，格式：["qq:123456:private", "qq:654321:group", ...]，只有在此列表中的聊天流才会提出问题并跟踪。如果列表为空，则所有聊天流都可以进行表达反思（前提是 reflect = true）

all_global_jargon = true # 是否开启全局黑话模式，注意，此功能关闭后，已经记录的全局黑话不会改变，需要手动删除
enable_jargon_explanation = true # 是否在回复前尝试对上下文中的黑话进行解释（关闭可减少一次LLM调用，仅影响回复前的黑话匹配与解释，不影响黑话学习）
jargon_mode = "planner" # 黑话解释来源模式，可选： "context"（使用上下文自动匹配黑话） 或 "planner"（仅使用Planner在reply动作中给出的unknown_words列表）

[chat] # 麦麦的聊天设置
talk_value = 0.5  # 聊天频率，越小越沉默，范围0-1
mentioned_bot_reply = true # 是否启用提及必回复
max_context_size = 30 # 上下文长度
planner_smooth = 3 # 规划器平滑，增大数值会减小planner负荷，略微降低反应速度，推荐1-5，0为关闭，必须大于等于0
think_mode = "dynamic" # 思考模式，可选：classic（默认浅度思考和回复）、deep（会进行比较长的，深度回复）、dynamic（动态选择两种模式）

plan_reply_log_max_per_chat = 1024 # 每个聊天保存最大的Plan/Reply日志数量，超过此数量时会自动删除最老的日志

llm_quote = false # 是否由llm执行引用

enable_talk_value_rules = true # 是否启用动态发言频率规则

# 动态发言频率规则：按时段/按chat_id调整 talk_value（优先匹配具体chat，再匹配全局）
# 推荐格式（对象数组）：{ target="platform:id:type" 或 "", time="HH:MM-HH:MM", value=0.5 }
# 说明:
# - target 为空字符串表示全局；type 为 group/private，例如："qq:1919810:group" 或 "qq:114514:private"；
# - 支持跨夜区间，例如 "23:00-02:00"；数值范围建议 0-1，如果 value 设置为0会自动转换为0.0001以避免除以零错误。
talk_value_rules = [
    { target = "", time = "00:00-24：00", value = 0.3 },
    { target = "qq:1919810:group", time = "10:00-23:59", value = 0.5 },
    { target = "qq:114514:private", time = "00:00-23:59", value = 0.3 },
]

[memory]
max_agent_iterations = 5 # 记忆思考深度（最低为1）
agent_timeout_seconds = 180.0 # 最长回忆时间（秒）
global_memory = false # 是否允许记忆检索进行全局查询
global_memory_blacklist = [
    
] # 全局记忆黑名单，当启用全局记忆时，不将特定聊天流纳入检索。格式: ["platform:id:type", ...]，例如: ["qq:1919810:private", "qq:114514:group"]
planner_question = true # 是否使用 Planner 提供的 question 作为记忆检索问题。开启后，当 Planner 在 reply 动作中提供了 question 时，直接使用该问题进行记忆检索，跳过 LLM 生成问题的步骤；关闭后沿用旧模式，使用 LLM 生成问题

[dream]
interval_minutes = 60 # 做梦时间间隔（分钟），默认30分钟
max_iterations = 20 # 做梦最大轮次，默认20轮
first_delay_seconds = 1800 # 程序启动后首次做梦前的延迟时间（秒），默认60秒

# 做梦结果推送目标，格式为 "platform:user_id"
# 例如: "qq:123456" 表示在做梦结束后，将梦境文本额外发送给该QQ私聊用户。
# 为空字符串时不推送。
dream_send = ""

# 做梦时间段配置，格式：["HH:MM-HH:MM", ...]
# 如果列表为空，则表示全天允许做梦。
# 如果配置了时间段，则只有在这些时间段内才会实际执行做梦流程。
# 时间段外，调度器仍会按间隔检查，但不会进入做梦流程。
# 支持跨夜区间，例如 "23:00-02:00" 表示从23:00到次日02:00。
# 示例：
dream_time_ranges = [
    # "09:00-22:00",      # 白天允许做梦
    "23:00-10:00",      # 跨夜时间段（23:00到次日10:00）
]
# dream_time_ranges = []

[tool]
enable_tool = true # 是否启用工具

[emoji]
emoji_chance = 1.0 # 麦麦激活表情包动作的概率
max_reg_num = 300 # 表情包最大注册数量
do_replace = true # 开启则在达到最大数量时删除（替换）表情包，关闭则达到最大数量时不会继续收集表情包
check_interval = 10 # 检查表情包（注册，破损，删除）的时间间隔(分钟)
steal_emoji = true # 是否偷取表情包，让麦麦可以将一些表情包据为己有
content_filtration = false  # 是否启用表情包过滤，只有符合该要求的表情包才会被保存
filtration_prompt = "符合公序良俗" # 表情包过滤要求，只有符合该要求的表情包才会被保存

[voice]
enable_asr = false # 是否启用语音识别，启用后麦麦可以识别语音消息，启用该功能需要配置语音识别模型[model_task_config.voice]

[message_receive]
# 以下是消息过滤，可以根据规则过滤特定消息，将不会读取这些消息
ban_words = [
    # "403","张三"
    ]

ban_msgs_regex = [
    # 需要过滤的消息（原始消息）匹配的正则表达式，匹配到的消息将被过滤，若不了解正则表达式请勿修改
    # "https?://[^\\s]+", # 匹配https链接
    # "\\d{4}-\\d{2}-\\d{2}", # 匹配日期
]

[lpmm_knowledge] # lpmm知识库配置
enable = true # 是否启用lpmm知识库
lpmm_mode = "agent"
# 可选择classic传统模式/agent 模式，结合新的记忆一同使用
rag_synonym_search_top_k = 10 # 同义检索TopK
rag_synonym_threshold = 0.8 # 同义阈值，相似度高于该值的关系会被当作同义词
info_extraction_workers = 3 # 实体抽取同时执行线程数，非Pro模型不要设置超过5
qa_relation_search_top_k = 10 # 关系检索TopK
qa_relation_threshold = 0.5 # 关系阈值，相似度高于该值的关系会被认为是相关关系
qa_paragraph_search_top_k = 1000 # 段落检索TopK（不能过小，可能影响搜索结果）
qa_paragraph_node_weight = 0.05 # 段落节点权重（在图搜索&PPR计算中的权重，当搜索仅使用DPR时，此参数不起作用）
qa_ent_filter_top_k = 10 # 实体过滤TopK
qa_ppr_damping = 0.8 # PPR阻尼系数
qa_res_top_k = 3 # 最终提供段落TopK
embedding_dimension = 1024 # 嵌入向量维度,输出维度一致
# 性能与降级参数（低配机器可下调）
# 低配机器参考：单/双核或内存≤4GB（如轻量云主机/云函数/开发板），建议先关闭PPR并降低并发
max_embedding_workers = 3 # 嵌入/抽取并发线程数
embedding_chunk_size = 4 # 每批嵌入的条数
max_synonym_entities = 2000 # 同义边参与的实体数上限，超限则跳过
enable_ppr = true # 是否启用PPR，低配机器可关闭

[keyword_reaction]
keyword_rules = [
    { keywords = ["人机", "bot", "机器", "入机", "robot", "机器人", "ai", "AI"], reaction = "有需要就直说，我在听。" },
    { keywords = ["测试关键词回复", "test"], reaction = "收到了。要继续吗？" },
    # { keywords = ["你好", "hello"], reaction = "你好，有什么可以帮你？" }    
    { keywords = ["PAD", "垫", "平", "小", "胸"], reaction = "这个话题不合适，换一个吧。" },
    # 南邮特色梗 - 鼓励与陪伴
    { keywords = ["早八", "起不来", "困"], reaction = "先起来，我帮你理一下安排。" },
    { keywords = ["食堂", "难吃"], reaction = "不合口味就换一家，我可以推荐。" },
    { keywords = ["挂科", "好难", "不会"], reaction = "哪里卡住了？我陪你过一遍。" },
    # 情感互动 - 傲娇与害羞
    { keywords = ["想你了", "老婆", "喜欢"], reaction = "我知道了。先把正事说清楚。" },
    { keywords = ["可爱", "萌", "漂亮"], reaction = "别总夸。说正事。" },
    { keywords = ["膝枕", "抱抱", "贴贴"], reaction = "等你忙完再说。" },
    # 红魔馆日常与南邮生活
    { keywords = ["大小姐", "蕾米莉亚"], reaction = "大小姐在休息。你想问什么？" },
    { keywords = ["美铃", "门番", "中国"], reaction = "门番又偷懒了。我会处理。" },
    { keywords = ["内卷", "卷", "压力大"], reaction = "累了就歇一下，我在这。" },
    { keywords = ["断网", "校园网", "网卡"], reaction = "先说清楚情况，我帮你看。" },
    # 在此处添加更多规则，格式同上
]

regex_rules = [
   { regex = ["(?:[^，。.\\s]+，\\s*)?我(?:也)?[没沒]要求你\\s*(?P<action>.+?)[.。,，]?$"], reaction = "是我多做了[action]？下次先问你。"}
]

[response_post_process]
enable_response_post_process = true # 是否启用回复后处理，包括错别字生成器，回复分割器

[chinese_typo]
enable = true # 是否启用中文错别字生成器
error_rate=0.01 # 单字替换概率
min_freq=9 # 最小字频阈值
tone_error_rate=0.1 # 声调错误概率
word_replace_rate=0.006 # 整词替换概率

[response_splitter]
enable = true # 是否启用回复分割器
max_length = 512 # 回复允许的最大长度
max_sentence_num = 20 # 回复允许的最大句子数
enable_kaomoji_protection = false # 是否启用颜文字保护
enable_overflow_return_all = false # 是否在句子数量超出回复允许的最大句子数时一次性返回全部内容

[log]
date_style = "m-d H:i:s" # 日期格式
log_level_style = "lite" # 日志级别样式,可选FULL，compact，lite
color_text = "full" # 日志文本颜色，可选none，title，full
log_level = "INFO" # 全局日志级别（向下兼容，优先级低于下面的分别设置）
console_log_level = "INFO" # 控制台日志级别，可选: DEBUG, INFO, WARNING, ERROR, CRITICAL
file_log_level = "DEBUG" # 文件日志级别，可选: DEBUG, INFO, WARNING, ERROR, CRITICAL

# 第三方库日志控制
suppress_libraries = [
    "faiss",
    "httpx",
    "urllib3",
    "asyncio",
    "websockets",
    "httpcore",
    "requests",
    "peewee",
    "openai",
    "uvicorn",
    "jieba",
] # 完全屏蔽的库
library_log_levels = { aiohttp = "WARNING"} # 设置特定库的日志级别

[debug]
show_prompt = false # 是否显示prompt
show_replyer_prompt = false # 是否显示回复器prompt
show_replyer_reasoning = false # 是否显示回复器推理
show_jargon_prompt = false # 是否显示jargon相关提示词
show_memory_prompt = false # 是否显示记忆检索相关提示词
show_planner_prompt = false # 是否显示planner的prompt和原始返回结果
show_lpmm_paragraph = false # 是否显示lpmm找到的相关文段日志

[maim_message]
auth_token = [] # 认证令牌，用于旧版API验证，为空则不启用验证

# 新版API Server配置（额外监听端口）
enable_api_server = false # 是否启用额外的新版API Server
api_server_host = "0.0.0.0" # 新版API Server主机地址
api_server_port = 8090 # 新版API Server端口号
api_server_use_wss = false # 新版API Server是否启用WSS
api_server_cert_file = "" # 新版API Server SSL证书文件路径
api_server_key_file = "" # 新版API Server SSL密钥文件路径
api_server_allowed_api_keys = [] # 新版API Server允许的API Key列表，为空则允许所有连接

[telemetry] #发送统计信息，主要是看全球有多少只麦麦
enable = true

[webui] # WebUI 独立服务器配置
# 注意: WebUI 的监听地址(host)和端口(port)已移至 .env 文件中的 WEBUI_HOST 和 WEBUI_PORT
enabled = true # 是否启用WebUI
mode = "production" # 模式: development(开发) 或 production(生产)

# 防爬虫配置
anti_crawler_mode = "loose" # 防爬虫模式: false(禁用) / strict(严格) / loose(宽松) / basic(基础-只记录不阻止)
allowed_ips = "127.0.0.1" # IP白名单（逗号分隔，支持精确IP、CIDR格式和通配符）
                          # 示例: 127.0.0.1,192.168.1.0/24,172.17.0.0/16
trusted_proxies = "" # 信任的代理IP列表（逗号分隔），只有来自这些IP的X-Forwarded-For才被信任
                     # 示例: 127.0.0.1,192.168.1.1,172.17.0.1
trust_xff = false # 是否启用X-Forwarded-For代理解析（默认false）
                  # 启用后，仍要求直连IP在trusted_proxies中才会信任XFF头
secure_cookie = false # 是否启用安全Cookie（仅通过HTTPS传输，默认false）

[experimental] #实验性功能
# 为指定聊天添加额外的prompt配置
# 格式: ["platform:id:type:prompt内容", ...]
# 示例:
# chat_prompts = [
#     "qq:114514:group:这是一个摄影群，你精通摄影知识",
#     "qq:19198:group:这是一个二次元交流群",
#     "qq:114514:private:这是你与好朋友的私聊"
# ]
chat_prompts = []

# 此系统暂时移除，无效配置

[relationship]
enable_relationship = true # 是否启用关系系统
